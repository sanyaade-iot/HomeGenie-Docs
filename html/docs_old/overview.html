<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
  <!--<![endif]-->
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>HomeGenie - Documentation</title>
    <meta name="description" content="HomeGenie: Open Source Home Automation Server in a Internet Of Things world. For Windows, Linux, Mac, Raspberry Pi.">
    <meta name="viewport" content="width=device-width">
    <meta name="google-translate-customization" content="4465409ca18a218d-3c5a592dabcc0b15-gd17525dd79b50c62-1c">
    <link rel="stylesheet" href="css/normalize.min.css">
    <link rel="stylesheet" href="css/main.css">
    <!-- JQuery Snippet -->
    <link rel="stylesheet" type="text/css" href="css/jquery.snippet.min.css">
    <link rel="stylesheet" type="text/css" href="css_pirobox/style_1/style.css">
    <!--::: OR :::-->
    <link rel="stylesheet" type="text/css" href="css_pirobox/style_2/style.css">
    <script type="text/javascript" src="js/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.2.custom.min.js"></script>
    <script type="text/javascript" src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    <script type="text/javascript" src="js/jquery.snippet.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/main.js"></script>
    <!--::: it depends on which style you choose :::-->
    <script type="text/javascript" src="js/pirobox_extended.js"></script>
    <script type="text/javascript" src="js/jquery.easing.min.js"></script>
    <script type="text/javascript" src="js/jquery.easy-ticker.min.js"></script>
    <!-- or use minified version  "pirobox_extended_min.js"  -->
    <script type="text/javascript">
            $(document).ready(function(){
                  // pirobox gallery
                  $().piroBox_ext({
                      piro_speed: 700,
                      bg_alpha: 0.5,
                      piro_scroll: true //pirobox always positioned at the center of the page
                  });
                  // smooth scroll
                  $(".scroll").click(function (event) {
                      event.preventDefault();
                      $('html,body').animate({ scrollTop: $(this.hash).offset().top }, 500);
                  });
                  // source code snippet
                  $("pre.csharp").snippet("csharp", { style: "kwrite", transparent: false, showNum: true });
            });			
      </script>
    <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-40902095-1', 'generoso.info');
            ga('send', 'pageview');
      </script>
  </head>
  <body>
    <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>      <![endif]-->
    <div class="header-container">
      <header class="wrapper clearfix">
        <h1 class="title">HomeGenie</h1>
        <nav>
          <ul>
            <li><a href="http://www.homegenie.it/">Home</a></li>
            <li><a href="http://www.homegenie.it/docs">Docs</a></li>
            <li><a href="http://www.homegenie.it/download.php">Download</a></li>
          </ul>
        </nav>
      </header>
    </div>
    <div class="main-container">
      <div class="main wrapper clearfix">
        <article style="width:100%">
          <aside class="blank">
            <script type="text/javascript">
                              function googleTranslateElementInit() {
                                    new google.translate.TranslateElement({pageLanguage: 'en', layout: google.translate.TranslateElement.InlineLayout.SIMPLE, gaTrack: true, gaId: 'UA-40902095-1'}, 'google_translate_element');
                              }
                              </script>
            <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script> </aside>
          <header>
            <!--h1>...</h1>
                              <p>                              ...                              </p--> </header>
          <section>
            <h1>Overview by examples</h1>
            <h2>Controlling modules</h2>
            So, as seen in the previous example, to control modules we will use the <em>Modules</em> helper class. The following examples are C# snippet but can be used for Javascript, Phyton and Ruby as well by adding the <em>hg.</em> prefix to the helper class name.<br>
            <h3>Selecting a module by Name</h3>
            <pre class="csharp">// select light with name "Ceiling Light"
var ceilingLight = Modules.WithName("Ceiling Light");
// turn it on
ceilingLight.On();
// wait 5 seconds and turn it off
Pause(5);
ceilingLight.Off();</pre>
            <h3>Selecting modules by Domain / Address</h3>
            <pre class="csharp">// select Z-Wave node 5
var zwave5 = Modules.InDomain("HomeAutomation.ZWave").WithAddress("5");
// select X10 module B4
var x10B4 = Modules.InDomain("HomeAutomation.X10").WithAddress("B4");
// turn them off
zwave5.Off();
x10B4.Off();</pre>
            <h3>Selecting modules by device Type</h3>
            <pre class="csharp">// select all switch type devices
var switches = Modules.OfDeviceType("Switch");</pre>
            <h3>Selecting modules in the same Group</h3>
            <pre class="csharp">// select and turn off all lights in the living room
Modules
    .InGroup("Living Room")
    .OfDeviceType("Dimmer,Light")
    .Off();</pre>
            <h3> </h3>
            <h3> </h3>
            <h3>Getting a reference to a module</h3>
            If we want to get a reference to the instance of a module selected with the <em>Modules</em> helper class, we will use the<em> Get()</em> method and then we will be able to access directly to all module parameters and read/modify them.<br>
            <pre class="csharp">// get the module instance and set a custom parameter on it
var module = Modules.WithName("Test Module").Get();
module.Parameter("MyCustom.Parameter").Value = "Just testing";</pre>
            <h3>Iterating through selected modules</h3>
            <span style="font-style: italic;">Javascript</span><br>
            <pre class="csharp">var selection = hg.Modules.InGroup("Living Room").SelectedModules;
for(i = 0; i &lt; selection.length; i++)
{
    var module = selection[i];
    module.On();
}</pre>
            <span style="font-style: italic;">CSharp</span><br>
            <pre class="csharp">var selection = Modules.InGroup("Living Room").SelectedModules;
foreach(var module in selection)
{
    module.On();
}</pre>
            <p>&nbsp;</p>
            <h2>Handling Events</h2>
            To handle module events (eg. a light changing on/off state, a temperature sensor value changes, ...) we will be using the <span style="font-style: italic;">Events Helper</span> class.<br>
            <h3> Forcing max dimmer level to limit power usage</h3>
            <pre class="csharp">When.ModuleParameterChange( (module, parameter) =&gt; 
{
    if (module.IsOfDeviceType("Dimmer") &amp;&amp; parameter.Is("Status.Level"))
    {
        // limit max dimmer level to 40% (Status.Level is stored as 0.0 to 1.0)
        if (parameter.DecimalValue &gt; 0.4)
        {
            module.Level = 40;
            // we don't want this event to be further processed by other listeners
            return false;
        }
    }
    // this event has not been handled here, so we allow it to be routed to other listeners
    return true;
});           </pre>
            Commonly used device type names are: <span style="font-style: italic;"><br>
              <br>
              Generic</span>, <span style="font-style: italic;">Program</span>, <span style="font-style: italic;">Switch</span>, <span style="font-style: italic;">Light</span>, <span style="font-style: italic;">Dimmer</span>, <span style="font-style: italic;">Sensor</span>, <span style="font-style: italic;">Temperature</span>, <span style="font-style: italic;">Siren</span>, <span style="font-style: italic;">Fan</span>, <span style="font-style: italic;">Thermostat</span>, <span style="font-style: italic;">Shutter</span>, <span style="font-style: italic;">DoorWindow</span>.<br>
            <br>
            Commonly used parameter names are: <br>
            <span style="font-style: italic;"><br>
              Status.Level</span>, <span style="font-style: italic;">Status.Battery</span>, <span style="font-style: italic;">Sensor.Generic</span>, <span style="font-style: italic;">Sensor.Temperature</span>, <span style="font-style: italic;">Sensor.Luminance</span>, <span style="font-style: italic;">Sensor.Humidity</span>, <span style="font-style: italic;">Sensor.DoorWindow</span>, <span style="font-style: italic;">Sensor.MotionDetect</span>, <span style="font-style: italic;">Sensor.Alarm</span>, <span style="font-style: italic;">Sensor.CarbonMonoxide</span>, <span style="font-style: italic;">Sensor.CarbonDioxide</span>, <span style="font-style: italic;">Sensor.Smoke</span>, <span style="font-style: italic;">Sensor.Heat</span>, <span style="font-style: italic;">Sensor.Flood</span>, <span style="font-style: italic;">Sensor.Tamper</span>, <span style="font-style: italic;">Meter.Watts</span>.<br>
            <br>
            All device type and parameter names are arbitrary and any user defined name is also possible. <br>
            It's the way our automation programs handle these that give them a specific semantic and logic mean.<br>
            <br>
            <h2>Time based events</h2>
            Some time we will need to run a program or take some actions upon time based events. The <span style="font-style: italic;">Scheduler Helper</span> class will let our programs to verify if a particular time event is occuring.<br>
            For better understanding how HG Scheduler works, see <a target="_blank" title="Events scheduler" href="http://www.homegenie.it/docs/scheduler.php">Events scheduler</a> documentation page.<br>
            <h3>Checking for a scheduler event occurence</h3>
            <pre class="csharp">// turn on the porch lights at sunrise
var porchLights = Modules.InGroup("Porch").OfDeviceType("Dimmer,Light");
var sunrise = Scheduler.WithName("Sunrise");
if (sunrise.IsScheduling())
{
    porchLights.On();
}
// check custom cron event (everyday at 11pm)
else if (Scheduler.IsScheduling("0 23 * * *"))
{
    porchLights.Off();
}</pre>
            <h3>Adding or updating scheduler events</h3>
            We can also programmatically add or update events to the Scheduler. This is what happen with the "Weather Underground Widget" program. It queries an external webservice to get current location enviromental data and also sunrise and sunset time. Once obtained these data, it updates the HG Scheduler by setting the "Sunrise" and "Sunset" events with data updated from the external webservice.<br>
            <pre class="csharp">// programmatically set the @Sunrise event to 6.40pm (fixed value)
Scheduler
    .WithName("Sunrise")
    .SetSchedule("40 18 * * *");
                  <br>// programmatically add a custom event (every Monday and Thursday at 4pm)
Scheduler
    .WithName("MyEvent")
    .SetSchedule("0 16 * * 1,4");</pre>
            <p>&nbsp;</p>
            <h2>Interacting with the external world</h2>
            Using the <span style="font-style: italic;">Net Helper</span> class, a program can interact with external world, get data from thirth party web service and integrate it into HG, for instance holding the data gained from the web service into the program module parameters.<br>
            For a complete working example we can see how the Philips Hue Bridge program (see Device and Things group) interacts with the Philips Hue hardware and how it creates virtual Color Light modules and make them controllable just as these were built-in in HG.<br>
            <span style="font-style: italic;">Net Helper</span> class also implement other network functionalities like <span style="font-style: italic;">Pinging </span>external hosts or sending <span style="font-style: italic;">E-Mail</span> with file attachments.<br>
            <h3>Calling an external WebService</h3>
            <pre class="csharp">// check if the freegeoip.net server is reachable
if (Net.Ping("freegeoip.net"))
{
    // get current location name from the freegeoip web service
    var iplocation = Net.WebService("<a href="http://freegeoip.net/json/" target="_blank">http://freegeoip.net/json/</a>").GetData();
    Program.Parameter("FreeGeoIP.Location").Value = iplocation.city;
    // show an event popup in the HG UI with the location name
    Program.Notify("IP to Location", iplocation.city);
}
else
{
    Program.Notify("IP to Location", "Service not reachable.");
} </pre>
            <h3>Sending e-mails</h3>
            <pre class="csharp">// send an e-mail (account settings must be configure from "Messaging and Social" group)
Net.SendMessage("pippo@pluto.com", "Test message", "Hello World!");            </pre>
            <h3>Tcp Socket and Serial Port I/O</h3>
            HG also offer other possibilities for communicating with external world by using the <em>Tcp Helper</em> class and <em>SerialPort Helper</em> class. The first one implement simple Tcp Socket I/O while the other one implement I/O over a standard Serial Port.<br>
            Both are using same identical methods and syntax. For an example see <em>Serial Port I/O Test</em> program from <em>Devices and Things</em> group.<br>
            <br>
            <h2>Need more examples?</h2>
            HomeGenie has got a bunch of system programs that can also be edited and reviewed just as user programs. So to get more complete examples we can dig into the source code of these programs as well.<br>
            <br>
            <br>
            <br>
          </section>
          <footer>
            <p align="center"><a href="index.html">[back to index]</a></p>
          </footer>
        </article>
      </div>
      <!-- #main --> </div>
    <!-- #main-container -->
    <div class="footer-container">
      <footer class="wrapper">
        <h3><a href="http://creativecommons.org/licenses/by-nc/3.0/" target="_blank" style="color:yellow">CC BY-NC 3.0</a> © 2012-2014 G-Labs</h3>
      </footer>
    </div>
  </body>
</html>
