<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
  <!--<![endif]-->
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>HomeGenie - Documentation</title>
    <meta name="description" content="HomeGenie: Open Source Home Automation Server in a Internet Of Things world. For Windows, Linux, Mac, Raspberry Pi.">
    <meta name="viewport" content="width=device-width">
    <meta name="google-translate-customization" content="4465409ca18a218d-3c5a592dabcc0b15-gd17525dd79b50c62-1c">
    <link rel="stylesheet" href="css/normalize.min.css">
    <link rel="stylesheet" href="css/main.css">
    <!-- JQuery Snippet -->
    <link rel="stylesheet" type="text/css" href="css/jquery.snippet.min.css">
    <link rel="stylesheet" type="text/css" href="css_pirobox/style_1/style.css">
    <!--::: OR :::-->
    <link rel="stylesheet" type="text/css" href="css_pirobox/style_2/style.css">
    <script type="text/javascript" src="js/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.2.custom.min.js"></script>
    <script type="text/javascript" src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    <script type="text/javascript" src="js/jquery.snippet.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/main.js"></script>
    <!--::: it depends on which style you choose :::-->
    <script type="text/javascript" src="js/pirobox_extended.js"></script>
    <script type="text/javascript" src="js/jquery.easing.min.js"></script>
    <script type="text/javascript" src="js/jquery.easy-ticker.min.js"></script>
    <!-- or use minified version  "pirobox_extended_min.js"  -->
    <script type="text/javascript">
            $(document).ready(function(){
                  // pirobox gallery
                  $().piroBox_ext({
                      piro_speed: 700,
                      bg_alpha: 0.5,
                      piro_scroll: true //pirobox always positioned at the center of the page
                  });
                  // smooth scroll
                  $(".scroll").click(function (event) {
                      event.preventDefault();
                      $('html,body').animate({ scrollTop: $(this.hash).offset().top }, 500);
                  });
                  // source code snippet
                  $("pre.csharp").snippet("csharp", { style: "kwrite", transparent: false, showNum: true });
            });			
      </script>
    <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-40902095-1', 'generoso.info');
            ga('send', 'pageview');
      </script>
  </head>
  <body>
    <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>      <![endif]-->
    <div class="header-container">
      <header class="wrapper clearfix">
        <h1 class="title">HomeGenie</h1>
        <nav>
          <ul>
            <li><a href="http://www.homegenie.it/">Home</a></li>
            <li><a href="http://www.homegenie.it/docs">Docs</a></li>
            <li><a href="http://www.homegenie.it/download.php">Download</a></li>
          </ul>
        </nav>
      </header>
    </div>
    <div class="main-container">
      <div class="main wrapper clearfix">
        <article style="width:100%">
          <aside class="blank">
            <script type="text/javascript">
                              function googleTranslateElementInit() {
                                    new google.translate.TranslateElement({pageLanguage: 'en', layout: google.translate.TranslateElement.InlineLayout.SIMPLE, gaTrack: true, gaId: 'UA-40902095-1'}, 'google_translate_element');
                              }
                              </script>
            <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script> </aside>
          <header>
            <!--h1>...</h1>
                              <p>                              ...                              </p--> </header>
          <section>
            <h1>Playing with HG and RaspberryPi</h1>
            <h2>Example project</h2>
            <h4>Creating an IoT ready distance sensor with Raspberry Pi and HomeGenie</h4>
            <p> <a href="images/docs/hgthing_04.jpg" rel="gallery" class="pirobox_gall" title="Looks a bit weird... but it works! =)"><img src="images/docs/hgthing_04.jpg" style="margin-right:20px" align="left" border="1" height="200"></a> One of the included programs in RaspberrySharp group is the <i>"HCSR04 - Ultrasonic Ranging Module"</i> program. This example require to be running on a <a target="_blank" href="http://www.raspberrypi.org/">Raspberry Pi</a> and have a <a target="_blank" href="https://www.google.it/search?q=HCSR04&amp;aq=f&amp;oq=HCSR04&amp;aqs=chrome.0.57j0l3j62l2.1971j0&amp;sourceid=chrome&amp;ie=UTF-8">HCSR04 module</a> wired to it. </p>
            <p> There are plenty of other things that can be connected to Raspberry Pi, and so, many possible applications: </p>
            <ul>
              <li>- <a target="_blank" href="http://www.raspberrypi-spy.co.uk/2013/03/top-10-things-to-connect-to-your-raspberry-pi/">"Top 10 Things to Connect to Your Raspberry Pi"</a></li>
              <li>- <a target="_blank" href="http://learn.adafruit.com/category/raspberry-pi">"AdaFruit Learning System"</a></li>
            </ul>
            <p> HomeGenie is using <a href="https://github.com/raspberry-sharp/raspberry-sharp-io" target="_blank">Raspberry#-IO</a> library for GPIO programming, turning Raspberry Pi into an integrated and ready to use <a href="http://en.wikipedia.org/wiki/Internet_of_Things" target="_blank">Internet of Things</a> development platform. </p>
            <p> This is the <i>Trigger Code</i> of the example program: </p>
            <pre class="csharp">// this Setup delegate will be executed once, when the program is enabled
Program.Setup(()=&gt;
{
  // set the widget that will display this program data (the distance).
  // the builtin 'homegenie/generic/sensor' widget, 
  // will display all parameters starting with Sensor.*
  Program.AddControlWidget("homegenie/generic/sensor");
  
  // initialize program parameters
  Program.Parameter("Sensor.Distance").Value = "";
  Program.Parameter("Sensor.StatusMessage").Value = "";
  
  // it makes program to respond to webservices calls:
  //     http://<hg_address>/api/EmbeddedSystems.Raspberry/HCSR04/Sensor.Distance
  When.WebServiceCallReceived("EmbeddedSystems.Raspberry/HCSR04/Sensor.Distance", ( option ) =&gt; 
  {
    return "{ 'ResponseValue' : '" + Program.Parameter("Sensor.Distance").Value + "' }";
  }); 
}); // end program setup
return true; // execute the 'Code to Run'</hg_address></pre>
            <p> This, is the <i>Code to Run</i>: </p>
            <pre class="csharp">// example code adapted from https://github.com/raspberry-sharp/
//
var triggerPin = ConnectorPin.P1Pin03.ToProcessor();
var echoPin = ConnectorPin.P1Pin07.ToProcessor();

using (var connection = new HcSr04Connection(triggerPin, echoPin))
{
    while (Program.IsEnabled)
    {
          
        try
        {
		    var distance = connection.GetDistance();
		    Program.Parameter("Sensor.Distance").Value = String.Format("{0:0.0}", (distance * 100));
		    Program.Parameter("Sensor.StatusMessage").Value = "OK";
        }
        catch
        {
            Program.Parameter("Sensor.Distance").Value = String.Format("{0:0.0}", (new Random().NextDouble() * 100));
            Program.Parameter("Sensor.StatusMessage").Value = "Warning: HcSr04 Module Timeout. Reported value is randomly generated.";
            // sleep some more if there was an error
            Pause ( 4 );
        }
      
        Pause( 1 ); // 1 second interval between parameter updates
    } 
}</pre>
            <p> At line #7 of the <i>Trigger Code</i> we see the instruction <b>Program.AddControlWidget("homegenie/generic/sensor")</b>. This will make our program to show up in module list when adding a module to a group. So after adding it to a group, the widget <i>Generic Sensor</i> will display all program parameter starting with <i>Sensor.*</i> (and so, Sensor.Distance and Sensor.StatusMessage). <br>
              The following screenshot, show how the program appear in the <i>Control</i> menu: </p>
            <div align="center"> <a title="Raspberry Pi Ultrasonic Range Sensor" href="images/docs/control_things.png" rel="gallery" class="pirobox_gall"><img src="images/docs/control_things.png" alt="" width="300"></a> </div>
            <p> With these few lines of code, we got the distance sensor program working, displaying values in the control menu and having also its own web service api. =) </p>
            <p><br>
            </p>
            <p><br>
            </p>
            <p><br>
            </p>
          </section>
          <footer>
            <p align="center"><a href="index.html">[back to index]</a></p>
          </footer>
        </article>
      </div>
      <!-- #main --> </div>
    <!-- #main-container -->
    <div class="footer-container">
      <footer class="wrapper">
        <h3><a href="http://creativecommons.org/licenses/by-nc/3.0/" target="_blank" style="color:yellow">CC BY-NC 3.0</a> © 2012-2014 G-Labs</h3>
      </footer>
    </div>
  </body>
</html>
